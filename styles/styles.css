
.gem-form-container {
  display: flex;
  flex-direction: column;
  max-height: 600px;
  padding: 0px 0;
  box-sizing: border-box;

  overflow: visible;
}

.gem-emote-bar form,
.gem-emote-bar .gem-form-container {
  height: 100%;
  max-height: 100%;
}

.window-app.gem-emote-bar {
  height: 70vh !important;
  max-height: 70vh !important;
  transition: none !important;
}

.gem-emote-bar .window-content {
  height: 100%;
  overflow: hidden;
  padding: 0;
}

.gem-form-container .gem-playmode-container {
  flex: 0 0 auto;
  padding: 4px 6px 0;
  margin: 0 0 6px 0;
}

.gem-emote-scroll-container {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  box-sizing: border-box;
  min-height: 0;
  overscroll-behavior: contain;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.gem-emote-scroll-container::-webkit-scrollbar {
  width: 0;
  background: transparent;
}

.gem-fixed-action-container {
  flex: 0 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0px;
  margin-top: 20px;
}

.gem-emote-buttons {

  --gem-gap: 6px;
  --gem-pad: 6px;
  --gem-icon: clamp(1.6rem, 5vw, 2.4rem);

  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: var(--gem-gap);

  width: 100%;
  max-width: 100%;
  margin: 0 auto;
  padding: var(--gem-pad);

  box-sizing: border-box;
  overflow: visible;
  scrollbar-width: none;
}

.gem-custom-emote-editor form,
.gem-trigger-editor form {
  display: flex;
  flex-direction: column;
}

.window-app.gem.gem-custom-emote-list .window-content,
.window-app.gem.gem-trigger-list .window-content,
.window-app.gem.gem-emote-sound-config .window-content,
.window-app.gem.gem-emote-visibility-manager .window-content,
.window-app.gem.gem-icon-picker .window-content,
.window-app.gem.gem-custom-emote-editor .window-content,
.window-app.gem.gem-trigger-editor .window-content {
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 0.5rem 0.75rem;
  box-sizing: border-box;
}

.gem-v2-form {
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  min-height: 0;
}

.gem-v2-body {
  flex: 1 1 auto;
  overflow: auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.gem-v2-footer {
  flex: 0 0 auto;
  display: flex;
  justify-content: center;
  gap: 0.5rem;
}

.gem-v2-footer.sheet-footer {
  margin-top: 0.25rem;
  padding-top: 0.5rem;

  background: color-mix(in srgb, var(--color-bg) 92%, black 8%);
  border-top: 1px solid var(--color-border);
}

.gem-emote-visibility .gem-visibility-row {
  display: flex;
  justify-content: space-between;
  align-items: center;

  border: 1px solid var(--color-border);
  border-radius: 6px;
  padding: 6px 8px;
}

.gem-emote-visibility .gem-visibility-row--active {
  background: color-mix(in srgb, var(--color-bg) 88%, var(--color-warm-2) 12%);
  border-color: var(--color-warm-2);
}

.gem-emote-visibility .gem-visibility-row--inactive {
  background: transparent;
  border-color: var(--color-border);
  opacity: 0.75;
}

.gem-emote-visibility .gem-visibility-row--unavailable {
  opacity: 0.5;
}

.gem-list-scroll {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.gem-custom-emote-editor form > .form-group,
.gem-trigger-editor form > .form-group {
  margin: 0;
}

.gem-custom-emote-editor form > .form-group + .form-group,
.gem-trigger-editor form > .form-group + .form-group {
  margin-top: 12px;
}

.gem-custom-emote-editor form .form-fields,
.gem-trigger-editor form .form-fields {
  display: flex;
  gap: 8px;
}

.gem-custom-emote-editor .gem-macro-group {
  /* Allow the macro area to take up any extra vertical space when the window is resized. */
  flex: 1 1 auto;
  min-height: 0;

  /* Override Foundry's default .form-group row layout so the editor can stretch vertically. */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.gem-custom-emote-editor .gem-macro-fields {
  /* Override the default row layout for .form-fields to be a column. */
  flex-direction: column;
  align-items: stretch;
  flex: 1 1 auto;
  min-height: 0;
  gap: 6px;

  /* Ensure the column fills the macro group's height. */
  height: 100%;
}

.gem-custom-emote-editor [name="macro"] {
  width: 100%;
  /* Some editor implementations apply inline sizing; ensure we always follow the flex container. */
  height: 100% !important;
  max-height: 100% !important;
}

.gem-custom-emote-editor .gem-macro-field {
  width: 100%;
  display: flex;
  flex-direction: column;
  /*
    Preferred editor height (pre-resize behavior) is ~320px.
    - When the window grows: this area can expand.
    - When the window shrinks: this area will shrink back down to 320px first.
    - Only after hitting 320px will the outer form start scrolling.
  */
  flex: 1 1 320px;
  min-height: 320px;
}

/* Make the generated formField/editor markup behave like a flex column so the editor can grow/shrink. */
.gem-custom-emote-editor .gem-macro-field > .form-group {
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.gem-custom-emote-editor .gem-macro-field > .form-group > .form-fields {
  flex: 1 1 auto;
  min-height: 0;
  align-items: stretch;
}

.gem-custom-emote-editor .gem-macro-field .form-group,
.gem-custom-emote-editor .gem-macro-field .form-fields,
.gem-custom-emote-editor .gem-macro-field .editor {
  /* Foundry's editor sometimes sets inline heights; force these to follow flex sizing. */
  height: 100% !important;
}

.gem-custom-emote-editor .gem-macro-field .editor {
  position: relative;
}

.gem-custom-emote-editor .gem-macro-field .editor-content {
  /* Ensure the actual editor surface resizes down as well (inline styles can otherwise "stick"). */
  height: 100% !important;
  max-height: 100% !important;
}
.gem-emote-buttons::-webkit-scrollbar {
  display: none;
}

button.gem-emote-btn {
  width: 100%;
  height: auto;
  aspect-ratio: 1 / 1;

  display: flex;
  justify-content: center;
  align-items: center;

  padding: 6px;
  box-sizing: border-box;

  min-height: 0;
  line-height: 1;
}

button.gem-emote-btn i {
  font-size: var(--gem-icon);
  margin: 0;
  line-height: 1;
  transform: translateY(1px);
}

.gem-icon-row {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  flex-wrap: nowrap;
}

.gem-icon-preview {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gem-icon-picker .icon-option.selected {
  background-color: var(--color-warm-2);
}

.gem-action-button-grid {
  --gem-action-gap: 6px;
  --gem-action-h: 34px;
  --gem-action-icon: 1rem;

  display: grid;
  gap: var(--gem-action-gap);

  width: 100%;
  max-width: 100%;
  margin: 5px auto 10px;
  padding: 0 6px;

  box-sizing: border-box;
}

.gem-action-container {
  width: 100%;
}

.gem-action-container.dual-column,
.gem-action-container.dual-column-custom,
.gem-action-container.single-column-custom {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: var(--gem-action-gap);
  width: 100%;
  box-sizing: border-box;
}

.gem-action-container.single-column-custom button.gem-action-button,
.gem-action-container.register-emote button.gem-action-button {
  grid-column: 1 / -1;
  width: 100%;
}

.gem-action-container.register-emote {
  grid-row: auto;
  gap: 0;
}

button.gem-action-button {
  width: 100%;
  height: var(--gem-action-h);

  display: inline-flex;
  justify-content: center;
  align-items: center;

  padding: 0;
  box-sizing: border-box;

  min-height: 0;
  line-height: 1;
}

button.gem-action-button i {
  font-size: var(--gem-action-icon);
  margin: 0;
  line-height: 1;
  transform: translateY(1px);
}

.form-footer button[data-action="gem-close"] {
  width: 120px;
  min-width: 100px !important;
  flex: 0 0 120px !important;
  margin: 0 auto;
}

.form-footer button[data-action="gem-wide-close"] {
  width: 150px;
  min-width: 100px !important;
  flex: 0 0 150px !important;
  margin: 0 auto;
}

.form-footer button[data-action="gem-ultrawide-close"] {
  width: 300px;
  min-width: 100px !important;
  flex: 0 0 300px !important;
  margin: 0 auto;
}

.form-footer button[data-action="gem-ultrawide-save"] {
  width: 300px;
  min-width: 100px !important;
  flex: 0 0 300px !important;
  margin: 0 auto;
}

.form-footer button[data-action="gem-wide-save"] {
  width: 150px;
  min-width: 100px !important;
  flex: 0 0 150px !important;
  margin: 0 auto;
}

.form-footer {
  display: flex;
  justify-content: center;
}

.gem-form-container .gem-playmode-row {
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
}

.gem-form-container .gem-playmode-toggle {
  position: relative;
  flex: 0 0 auto;

  width: 7.25rem;
  height: 1.45rem;
  padding: 0.05rem 0.55rem 0;

  display: inline-flex;
  align-items: center;
  justify-content: flex-end;

  font-size: 0.8rem;
  line-height: 1;
  border-radius: 999px;
  border: 1px solid var(--color-border, #555);
  /* Fallback for themes/browsers that don't support color-mix(). */
  background: rgba(0, 0, 0, 0.22) !important;
  color: var(--color-text);
  cursor: var(--cursor-pointer);
  white-space: nowrap;
  overflow: visible;

  transition:
    background 120ms ease-out,
    border-color 120ms ease-out,
    box-shadow 120ms ease-out,
    transform 80ms ease-out;
}

.gem-form-container .gem-playmode-toggle::before {
  content: "";
  position: absolute;

  width: 1.1rem;
  height: 1.1rem;
  border-radius: 999px;

  background: var(--color-bg, #1b1b1b) !important;
  /* Fallback for themes/browsers that don't support color-mix(). */
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow:
    0 0 0 1px rgba(255, 255, 255, 0.10),
    0 1px 2px rgba(0, 0, 0, 0.4);

  top: 50%;
  transform: translateY(-50%);
  left: 0.22rem;

  transition:
    left 150ms ease-out,
    right 150ms ease-out,
    background 120ms ease-out,
    border-color 120ms ease-out,
    box-shadow 120ms ease-out,
    transform 120ms ease-out;
}

.gem-form-container .gem-playmode-toggle .gem-playmode-text {
  position: relative;
  z-index: 1;
  pointer-events: none;
}

.gem-form-container .gem-playmode-toggle .gem-playmode-text--timed {
  display: none;
}

.gem-form-container .gem-playmode-toggle:hover {
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.22);
  outline: none;
}

@supports (background: color-mix(in srgb, black 50%, white 50%)) {
  .gem-form-container .gem-playmode-toggle {
    background: color-mix(in srgb, var(--color-bg, #1b1b1b) 92%, var(--color-border, #555) 8%) !important;
  }

  .gem-form-container .gem-playmode-toggle::before {
    border: 1px solid color-mix(in srgb, var(--color-text-light-0) 80%, transparent 20%);
    box-shadow:
      0 0 0 1px color-mix(in srgb, var(--color-border) 60%, transparent 40%),
      0 1px 2px rgba(0, 0, 0, 0.4);
  }

  .gem-form-container .gem-playmode-toggle:hover {
    box-shadow: 0 0 0 1px color-mix(in srgb, var(--color-warm-2) 40%, transparent 60%);
  }
}


.gem-form-container .gem-playmode-duration input:disabled {
  opacity: 0.7;
}
.gem-form-container .gem-playmode-toggle.is-on {
  justify-content: flex-start;
  background: var(--color-warm-2, #c26c00) !important;
  border-color: var(--color-warm-3);
  color: var(--color-text-light-0);
}

.gem-form-container .gem-playmode-toggle.is-on::before {
  left: auto;
  right: 0.22rem;
}

.gem-form-container .gem-playmode-toggle.is-on .gem-playmode-text--permanent {
  display: none;
}
.gem-form-container .gem-playmode-toggle.is-on .gem-playmode-text--timed {
  display: inline;
}

.gem-form-container .gem-playmode-row {
  overflow: visible;
}

.gem-form-container .gem-playmode-toggle {
  overflow: visible;
}

.gem-form-container .gem-playmode-duration {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 6px;
  margin-bottom: 6px;
  padding: 0 6px;
}

.gem-form-container .gem-playmode-duration input[type="range"] {
  flex: 1 1 auto;
  min-width: 0;
}

.gem-form-container .gem-playmode-duration input[type="number"] {
  flex: 0 0 auto;
  width: 64px;
  padding: 2px 6px;
}
